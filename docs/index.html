<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Global Entry Appointment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Free push alerts via ntfy.sh when Global Entry slots open up" />

    <meta property="og:title" content="Global Entry Appointment" />
    <meta property="og:description" content="Free push alerts via ntfy.sh when Global Entry slots open up" />
    <meta property="og:url" content="https://arun0009.github.io/global-entry-appointment" />
    <meta property="og:image" content="https://arun0009.github.io/global-entry-appointment/preview.png" />

    <meta name="twitter:title" content="Global Entry Appointment">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:description" content="Free push alerts via ntfy.sh when Global Entry slots open up" />
    <meta name="twitter:url" content="https://arun0009.github.io/global-entry-appointment">
    <meta name="twitter:image" content="https://arun0009.github.io/global-entry-appointment/preview.png" />

    <meta name="theme-color" content="#2563eb" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3BRX32YSZJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3BRX32YSZJ');
    </script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center px-4">
<div class="max-w-xl w-full bg-white p-8 rounded-xl shadow-md">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-3">Global Entry Appointment</h1>

    <p class="text-center text-sm text-gray-700 mb-6">
        We continuously check for open Global Entry appointments and send you free push notifications via the ntfy app when one becomes available.
    </p>

    <form id="alert-form" class="space-y-5">
        <div>
            <label for="location" class="block font-semibold mb-1">Enrollment Center</label>
            <select id="location" required class="w-full p-2 border border-gray-300 rounded">
                <option value="">Loading locations...</option>
            </select>
        </div>

        <div>
            <label for="topic" class="block font-semibold mb-1">Ntfy Topic</label>
            <input type="text" id="topic" name="topic"
                   placeholder="e.g. my-topic-123 (no spaces, no special chars)"
                   required
                   pattern="^[a-zA-Z0-9_-]+$"
                   class="w-full p-2 border border-gray-300 rounded" />
        </div>

        <div>
            <span class="block font-semibold mb-1">Action</span>
            <div class="flex gap-6">
                <label class="inline-flex items-center">
                    <input type="radio" id="subscribe" name="action" value="subscribe" checked class="mr-2">
                    Subscribe
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" id="unsubscribe" name="action" value="unsubscribe" class="mr-2">
                    Unsubscribe
                </label>
            </div>
        </div>

        <button type="submit"
                class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
            Submit
        </button>

        <p id="status" class="text-center font-semibold mt-2 text-sm"></p>
    </form>

    <div class="mt-8 p-4 border border-gray-300 rounded-lg bg-gray-50">
        <h2 class="text-lg font-semibold mb-2">ðŸ“± How to Get Push Notifications</h2>
        <p class="mb-2">
            This app uses <a href="https://ntfy.sh" target="_blank" class="text-blue-600 underline">ntfy.sh</a> for push notifications.
            To receive alerts:
        </p>
        <ul class="list-disc list-inside mb-2">
            <li><a href="https://apps.apple.com/us/app/ntfy/id1625396347" target="_blank" class="text-blue-600 underline">Download ntfy for iOS</a></li>
            <li><a href="https://play.google.com/store/apps/details?id=io.heckel.ntfy" target="_blank" class="text-blue-600 underline">Download ntfy for Android</a></li>
        </ul>
        <p class="mb-4">
            After installing, open the app and create a topic name (e.g. <code>my-global-entry-alerts</code>).
            Enter that topic above to subscribe for appointment alerts.
        </p>

        <div class="flex justify-center">
            <a href="https://www.buymeacoffee.com/arun0009" target="_blank">
                <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png"
                     alt="Buy Me A Coffee"
                     style="height: 41px !important;width: 174px !important;box-shadow: 0px 3px 2px 0px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 3px 2px 0px rgba(190, 190, 190, 0.5) !important;" />
            </a>
        </div>
        <!-- Social Media Logos -->
        <div class="flex justify-center gap-6 mt-6">
            <a href="https://x.com/agopalpuri" target="_blank"  class="text-gray-700 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="w-6 h-6 fill-current">
                    <path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/>
                </svg>
            </a>
            <a href="https://www.reddit.com/user/arun0009/" target="_blank"  class="text-gray-700 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="w-6 h-6 fill-current">
                    <path d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 65.2 95.2 146.6 95.2 81.2 0 146.6-42.6 146.6-95.2 0-5.3-.6-10.5-1.7-15.5 31.7-15.9 20.4-62.8-14.4-62.8zM305.7 305.1c-13.6 0-24.6-11.1-24.6-24.9 0-13.6 11.1-24.6 24.6-24.6 13.6 0 24.6 11.1 24.6 24.6 0 13.6-11 24.9-24.6 24.9z"/>
                </svg>
            </a>
            <a href="https://github.com/arun0009/global-entry-appointment" target="_blank" class="text-gray-700 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="w-6 h-6 fill-current">
                    <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-.7 3.6 1.9 4.9 2.6 1.3 5.7 .7 6.5-1.3 .9-1.6-.3-3.6-1.9-4.9-2.6-1.3-5.7-.7-6.5 1.3z"/>
                </svg>
            </a>
        </div>
    </div>
</div>

<script>
    async function fetchLocations() {
        try {
            const res = await fetch("https://ttp.cbp.dhs.gov/schedulerapi/locations/?temporary=false&inviteOnly=false&operational=true&serviceName=Global%20Entry");
            const locations = await res.json();

            locations.sort((a, b) => a.name.localeCompare(b.name));

            const select = document.getElementById("location");
            select.innerHTML = '<option value="">-- Select a location --</option>';

            locations.forEach(loc => {
                const labelParts = [
                    loc.name,
                    loc.addressAdditional || loc.address,
                    `${loc.city} ${loc.state} ${loc.postalCode}`
                ];
                const text = labelParts.filter(Boolean).join(" â€“ ");
                const option = new Option(text, loc.id);
                select.add(option);
            });
        } catch {
            document.getElementById("location").innerHTML = '<option>Error loading locations</option>';
        }
    }

    document.getElementById("alert-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const location = document.getElementById("location").value;
        const topic = document.getElementById("topic").value.trim();
        const action = document.querySelector('input[name="action"]:checked').value;

        if (!location || !topic) {
            document.getElementById("status").textContent = "Please fill out all fields.";
            return;
        }

        const payload = { action, location, ntfyTopic: topic };
        const endpoint = "https://52vuz4sy6kozejx3ams5kagm7u0htxal.lambda-url.us-east-1.on.aws/subscriptions";

        try {
            const res = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            });

            const text = await res.text();
            document.getElementById("status").textContent = text || "Request successful!";
        } catch {
            document.getElementById("status").textContent = "Error submitting request.";
        }
    });

    // Handle auto-check unsubscribe radio if query param is present
    window.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        if (params.get("subscriptions") === "unsubscribe") {
            document.getElementById("unsubscribe").checked = true;
        }
    });

    fetchLocations();
</script>
</body>
</html>
