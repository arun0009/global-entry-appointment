<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Global Entry Appointment Alerts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Get instant push notifications when Global Entry appointment slots open up. Free alerts via ntfy.sh app." />

    <meta property="og:title" content="Global Entry Appointment Alerts" />
    <meta property="og:description" content="Get instant push notifications when Global Entry appointment slots open up. Free alerts via ntfy.sh app." />
    <meta property="og:url" content="https://arun0009.github.io/global-entry-appointment" />
    <meta property="og:image" content="https://arun0009.github.io/global-entry-appointment/preview.png" />

    <meta name="twitter:title" content="Global Entry Appointment Alerts">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:description" content="Get instant push notifications when Global Entry appointment slots open up. Free alerts via ntfy.sh app." />
    <meta name="twitter:url" content="https://arun0009.github.io/global-entry-appointment">
    <meta name="twitter:image" content="https://arun0009.github.io/global-entry-appointment/preview.png" />

    <meta name="theme-color" content="#3b82f6" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LeFq3UrAAAAAA_0X0iVa-d-S6ZUsflfjJgL7vE-"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3BRX32YSZJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3BRX32YSZJ');
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#4F7FFF',
                            50: '#F0F4FF',
                            100: '#E0EAFF',
                            500: '#4F7FFF',
                            600: '#3B6AE6',
                            700: '#2851CC'
                        }
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        @keyframes pulse-glow {
            from { box-shadow: 0 0 20px rgba(79, 127, 255, 0.3); }
            to { box-shadow: 0 0 30px rgba(79, 127, 255, 0.6), 0 0 40px rgba(79, 127, 255, 0.3); }
        }
        body {
            font-family: 'Inter', 'sans-serif';
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 text-slate-800 min-h-screen font-inter">
<div class="min-h-screen py-8 px-4">
    <div class="max-w-4xl mx-auto space-y-8">
        <!-- Hero Section -->
        <div class="text-center space-y-6">
            <div class="relative overflow-hidden rounded-2xl shadow-2xl">
                <img src="global-entry-banner.png"
                     alt="Global Entry Appointment Service"
                     class="w-full h-64 object-cover">
                <div class="absolute inset-0 bg-gradient-to-r from-primary-600/80 to-primary-500/60 flex items-center justify-center">
                    <div class="text-center space-y-4 z-10">
                        <div class="animate-float">
                            <svg class="w-16 h-16 text-white mx-auto mb-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                            </svg>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">
                            Global Entry Alerts
                        </h1>
                        <p class="text-xl text-white/90 max-w-2xl">
                            Never miss an available appointment slot again
                        </p>
                    </div>
                </div>
            </div>

            <p class="text-lg text-slate-600 max-w-3xl mx-auto leading-relaxed">
                Get instant push notifications via the <span class="font-semibold text-primary-600">ntfy</span> app
                when Global Entry appointment slots open up. Stay ahead with real-time alerts!
            </p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Form -->
            <div class="lg:col-span-2">
                <div class="bg-white/80 backdrop-blur-sm shadow-2xl rounded-2xl border border-slate-200/50">
                    <div class="text-center pb-6 pt-8 px-8">
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">
                            Setup Your Alerts
                        </h2>
                        <p class="text-slate-600">
                            Configure notifications for your preferred enrollment center
                        </p>
                    </div>
                    <div class="px-8 pb-8">
                        <form id="alert-form" class="space-y-6">
                            <div class="space-y-2">
                                <label for="location" class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-primary-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                    </svg>
                                    Enrollment Center
                                </label>
                                <select id="location" required class="w-full p-3 rounded-lg border border-slate-300 bg-white/70 backdrop-blur-sm text-slate-800 transition-all duration-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:bg-white h-12">
                                    <option value="">Loading locations...</option>
                                </select>
                            </div>

                            <div class="space-y-2">
                                <label for="topic" class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-primary-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM7 4h10v16H7V4zm8.5 11.5c0 .8-.7 1.5-1.5 1.5s-1.5-.7-1.5-1.5.7-1.5 1.5-1.5 1.5.7 1.5 1.5zm-4 0c0 .8-.7 1.5-1.5 1.5S8 16.3 8 15.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5z"/>
                                    </svg>
                                    Ntfy Topic
                                </label>
                                <input type="text" id="topic" name="topic"
                                       placeholder="see setup instructions"
                                       required
                                       pattern="^[a-zA-Z0-9_-]+$"
                                       class="w-full p-3 rounded-lg border border-slate-300 bg-white/70 backdrop-blur-sm text-slate-800 transition-all duration-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:bg-white h-12" />
                                <p class="text-xs text-slate-500">
                                    Only letters, numbers, underscores, and hyphens are allowed
                                </p>
                            </div>

                            <div class="space-y-3">
                                <span class="block text-sm font-semibold text-slate-700">Action</span>
                                <div class="flex gap-8">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" id="subscribe" name="action" value="subscribe" checked class="mr-2 text-primary-500 focus:ring-primary-500">
                                        <span class="font-medium text-slate-700">Subscribe</span>
                                    </label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" id="unsubscribe" name="action" value="unsubscribe" class="mr-2 text-primary-500 focus:ring-primary-500">
                                        <span class="font-medium text-slate-700">Unsubscribe</span>
                                    </label>
                                </div>
                            </div>

                            <input type="hidden" id="recaptcha_token" name="recaptcha_token" />
                            <button type="button"
                                    class="w-full py-4 rounded-lg text-base font-semibold text-white h-14 flex items-center justify-center gap-2 bg-gradient-to-r from-primary-600 to-primary-500 shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 animate-pulse-glow g-recaptcha"
                                    data-sitekey="6LeFq3UrAAAAAA_0X0iVa-d-S6ZUsflfjJgL7vE-"
                                    data-callback="onSubmit"
                                    data-action="submit">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                                    <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                                </svg>
                                Start Receiving Alerts
                            </button>

                            <p id="status" class="text-center font-medium text-sm mt-4"></p>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Instructions Sidebar -->
            <div class="space-y-6">
                <div class="bg-white/80 backdrop-blur-sm shadow-2xl rounded-2xl border border-slate-200/50">
                    <div class="pt-6 px-6 pb-2">
                        <h3 class="text-xl font-bold flex items-center gap-2 text-slate-800">
                            <svg class="w-6 h-6 text-primary-500" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM7 4h10v16H7V4zm8.5 11.5c0 .8-.7 1.5-1.5 1.5s-1.5-.7-1.5-1.5.7-1.5 1.5-1.5 1.5.7 1.5 1.5zm-4 0c0 .8-.7 1.5-1.5 1.5S8 16.3 8 15.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5z"/>
                            </svg>
                            Setup Instructions
                        </h3>
                    </div>
                    <div class="px-6 pb-6 space-y-4">
                        <div class="space-y-3">
                            <h4 class="font-semibold text-sm text-slate-700">📱 Download ntfy App</h4>
                            <div class="space-y-2">
                                <a href="https://apps.apple.com/us/app/ntfy/id1625396347" target="_blank" rel="noopener noreferrer" class="block">
                                    <button class="w-full p-3 rounded-lg text-left transition-all duration-300 text-sm font-medium justify-start flex bg-white/70 border border-slate-200 hover:bg-primary-50 hover:border-primary-300 hover:text-primary-700">
                                        📱 iOS App Store
                                    </button>
                                </a>
                                <a href="https://play.google.com/store/apps/details?id=io.heckel.ntfy" target="_blank" rel="noopener noreferrer" class="block">
                                    <button class="w-full p-3 rounded-lg text-left transition-all duration-300 text-sm font-medium justify-start flex bg-white/70 border border-slate-200 hover:bg-primary-50 hover:border-primary-300 hover:text-primary-700">
                                        🤖 Google Play Store
                                    </button>
                                </a>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <h4 class="font-semibold text-sm text-slate-700">🔔 Create Topic</h4>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                Open the ntfy app and create a <b>unique</b> topic name (e.g., <code class="bg-slate-100 px-1 rounded text-xs">global-entry-alerts-4-arun0009</code>).
                                Use the same topic name in the form.
                            </p>
                        </div>

                        <div class="space-y-2">
                            <h4 class="font-semibold text-sm text-slate-700">ℹ️ Notification Limit</h4>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                Your subscription will send up to 30 alerts for available appointment slots or last 30 days, whichever comes first. You’ll be notified when it ends.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Support Section -->
                <div class="bg-white/80 backdrop-blur-sm shadow-2xl rounded-2xl border border-slate-200/50">
                    <div class="pt-6 px-6 pb-6">
                        <div class="text-center space-y-4">
                            <h4 class="font-semibold flex items-center justify-center gap-2 text-slate-800">
                                <svg class="w-5 h-5 text-primary-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M18.5 2h-13C4.67 2 4 2.67 4 3.5v17l8-3 8 3v-17C20 2.67 19.33 2 18.5 2z"/>
                                </svg>
                                Support This Project
                            </h4>
                            <a href="https://www.buymeacoffee.com/arun0009" class="flex justify-center">
                                <img id="bmc-button" />
                            </a>

                            <script>
                                const baseUrl = "https://img.buymeacoffee.com/button-api/?text=Buy%20me%20a%20coffee&emoji=&slug=arun0009&button_colour=5F7FFF&font_colour=ffffff&font_family=Cookie&outline_colour=000000&coffee_colour=FFDD00";
                                const img = document.getElementById("bmc-button");
                                img.src = `${baseUrl}&_=${new Date().getTime()}`;
                            </script>

                            <div class="flex justify-center gap-4 pt-4">
                                <a href="https://x.com/agopalpuri" target="_blank" rel="noopener noreferrer" class="text-slate-500 hover:text-primary-600 transition-colors duration-300">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                    </svg>
                                </a>
                                <a href="https://www.reddit.com/user/arun0009/" target="_blank" rel="noopener noreferrer" class="text-slate-500 hover:text-primary-600 transition-colors duration-300">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                                    </svg>
                                </a>
                                <a href="https://github.com/arun0009/global-entry-appointment" target="_blank" rel="noopener noreferrer" class="text-slate-500 hover:text-primary-600 transition-colors duration-300">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Store locations globally to access shortName and timezone
    let globalLocations = [];

    function onSubmit(token) {
        document.getElementById("recaptcha_token").value = token;
        submitForm();
    }

    async function fetchLocations() {
        try {
            const res = await fetch("https://ttp.cbp.dhs.gov/schedulerapi/locations/?temporary=false&inviteOnly=false&operational=true&serviceName=Global%20Entry");
            const locations = await res.json();

            // Store locations for later use
            globalLocations = locations.sort((a, b) => a.name.localeCompare(b.name));

            const select = document.getElementById("location");
            select.innerHTML = '<option value="">-- Select a location --</option>';

            globalLocations.forEach(loc => {
                const labelParts = [
                    loc.name,
                    loc.addressAdditional || loc.address,
                    `${loc.city} ${loc.state} ${loc.postalCode}`
                ];
                const text = labelParts.filter(Boolean).join(" – ");
                const option = new Option(text, loc.id);
                select.add(option);
            });
        } catch {
            document.getElementById("location").innerHTML = '<option>Error loading locations</option>';
        }
    }

    async function submitForm() {
        const locationId = document.getElementById("location").value;
        const topic = document.getElementById("topic").value.trim();
        const action = document.querySelector('input[name="action"]:checked').value;
        const recaptchaToken = document.getElementById("recaptcha_token").value;
        const submitButton = document.querySelector('.g-recaptcha');
        const status = document.getElementById("status");

        if (!locationId || !topic || !recaptchaToken) {
            status.textContent = "Please fill out all fields and complete reCAPTCHA.";
            status.className = "text-center font-medium text-sm mt-4 text-red-600";
            return;
        }

        const selectedLocation = globalLocations.find(loc => loc.id === Number(locationId));
        if (!selectedLocation) {
            status.textContent = "Selected location not found.";
            status.className = "text-center font-medium text-sm mt-4 text-red-600";
            return;
        }

        submitButton.innerHTML = `
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Processing...
            `;
        submitButton.disabled = true;

        const payload = {
            action,
            location: String(locationId),
            shortName: selectedLocation.shortName || selectedLocation.name,
            timezone: selectedLocation.tzData || "America/New_York",
            ntfyTopic: topic,
            recaptchaToken: recaptchaToken
        };
        const endpoint = "https://52vuz4sy6kozejx3ams5kagm7u0htxal.lambda-url.us-east-1.on.aws/subscriptions";

        try {
            const res = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const text = await res.text();
            status.textContent = text || "Request successful!";
            status.className = "text-center font-medium text-sm mt-4 text-green-600";

            if (action === 'subscribe') {
                document.getElementById("topic").value = '';
                document.getElementById("location").value = '';
                document.getElementById("recaptcha_token").value = '';
            }
        } catch {
            status.textContent = "Error submitting request.";
            status.className = "text-center font-medium text-sm mt-4 text-red-600";
        } finally {
            updateSubmitButton();
            submitButton.disabled = false;
        }
    }

    function updateSubmitButton() {
        const action = document.querySelector('input[name="action"]:checked').value;
        const submitButton = document.querySelector('.g-recaptcha');
        const icon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
            </svg>`;
        submitButton.innerHTML = `${icon} ${action === 'subscribe' ? 'Start Receiving Alerts' : 'Stop Alerts'}`;
    }

    document.getElementById("alert-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        grecaptcha.execute('6LeFq3UrAAAAAA_0X0iVa-d-S6ZUsflfjJgL7vE-', { action: 'submit' }).then(function(token) {
            onSubmit(token);
        }).catch(function(error) {
            console.error('reCAPTCHA Error:', error);
            document.getElementById("status").textContent = "reCAPTCHA failed. Please try again.";
            document.getElementById("status").className = "text-center font-medium text-sm mt-4 text-red-600";
        });
    });

    document.addEventListener('change', function(e) {
        if (e.target.name === 'action') {
            updateSubmitButton();
        }
    });

    window.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        if (params.get("subscriptions") === "unsubscribe") {
            document.getElementById("unsubscribe").checked = true;
            updateSubmitButton();
        }
        fetchLocations();
    });
</script>
</body>
</html>